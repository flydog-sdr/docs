(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{373:function(t,e,r){"use strict";r.r(e);var s=r(18),a=Object(s.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"构建-docker-镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#构建-docker-镜像"}},[t._v("#")]),t._v(" 构建 Docker 镜像")]),t._v(" "),r("p",[t._v("FlyDog SDR 在 Docker 中运行，所以需要构建 Docker 镜像。")]),t._v(" "),r("h2",{attrs:{id:"搭建开发环境"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#搭建开发环境"}},[t._v("#")]),t._v(" 搭建开发环境")]),t._v(" "),r("p",[t._v("要构建用于 FlyDog SDR 的 Docker 镜像，需要在 "),r("code",[t._v("armv7l")]),t._v(" 处理器架构的环境下进行操作，或是使用 Docker Buildx 进行跨平台构建（不推荐，且目前需要开启 Docker 实验特性）。")]),t._v(" "),r("h3",{attrs:{id:"安装-docker"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#安装-docker"}},[t._v("#")]),t._v(" 安装 Docker")]),t._v(" "),r("p",[t._v("对处理器架构进行检查，架构需要为 "),r("code",[t._v("armv7l")]),t._v("。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[fdsdr@flydog-sdr-project: ~]$ uname -m\narmv7l\n")])])]),r("p",[t._v("使用 Docker 相关安装脚本实现自动化安装。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[fdsdr@flydog-sdr-project ~]$ sudo curl -o /tmp/get-docker.sh https://get.docker.com\n[fdsdr@flydog-sdr-project ~]$ sudo chmod +x /tmp/get-docker.sh\n[fdsdr@flydog-sdr-project ~]$ sudo sh -c /tmp/get-docker.sh\n")])])]),r("p",[t._v("对于中国大陆，在安装 Docker 时，可以加上 "),r("code",[t._v("--mirror AzureChinaCloud")]),t._v(" 参数，使用 AzureChinaCloud 镜像进行安装。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[fdsdr@flydog-sdr-project ~]$ sudo sh -c /tmp/get-docker.sh --mirror AzureChinaCloud\n")])])]),r("p",[t._v("安装完成后，将当前用户添加至 Docker 用户组 "),r("code",[t._v("docker")]),t._v("，然后重启。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[fdsdr@flydog-sdr-project ~]$ sudo usermod -aG docker ${USER}\n[fdsdr@flydog-sdr-project ~]$ sudo systemctl enable docker\n[fdsdr@flydog-sdr-project ~]$ sudo reboot\n")])])]),r("h3",{attrs:{id:"拉取-docker-基础镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#拉取-docker-基础镜像"}},[t._v("#")]),t._v(" 拉取 Docker 基础镜像")]),t._v(" "),r("p",[t._v("FlyDog SDR 使用 Bebian Buster 作为基础镜像进行构建。")]),t._v(" "),r("p",[t._v("从 DockerHub 拉取 "),r("code",[t._v("debian:buster-slim")]),t._v("。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[fdsdr@flydog-sdr-project ~]$ docker pull debian:buster-slim\n")])])]),r("p",[t._v("对于中国大陆，在拉取基础镜像时，可以使用 Aliyun 的 Docker 镜像加速器。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[fdsdr@flydog-sdr-project ~]$ docker pull flydog-sdr.mirror.aliyuncs.com/library/debian:buster-slim\n[fdsdr@flydog-sdr-project ~]$ docker tag flydog-sdr.mirror.aliyuncs.com/library/debian:buster-slim debian:buster-slim\n[fdsdr@flydog-sdr-project ~]$ docker image rm flydog-sdr.mirror.aliyuncs.com/library/debian:buster-slim\n")])])]),r("h2",{attrs:{id:"执行构建"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#执行构建"}},[t._v("#")]),t._v(" 执行构建")]),t._v(" "),r("p",[t._v("使用 Git 获取 FlyDog SDR 的 Dockerfile。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[fdsdr@flydog-sdr-project ~]$ git clone https://github.com/flydog-sdr/docker-builder\n")])])]),r("p",[t._v("对于中国大陆，可以使用 GitHub 镜像（github.com.cnpmjs.org）进行拉取。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[fdsdr@flydog-sdr-project ~]$ git clone https://github.com.cnpmjs.org/flydog-sdr/docker-builder\n")])])]),r("p",[t._v("进入 "),r("code",[t._v("flydog-sdr")]),t._v(" 目录，对 Dockerfile 中相关环境变量酌情修改。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[fdsdr@flydog-sdr-project ~]$ cd docker-builder/flydog-sdr\n[fdsdr@flydog-sdr-project flydog-sdr]$ vim Dockerfile\n")])])]),r("table",[r("thead",[r("tr",[r("th",{staticStyle:{"text-align":"left"}},[t._v("变量")]),t._v(" "),r("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),r("tbody",[r("tr",[r("td",{staticStyle:{"text-align":"left"}},[r("code",[t._v("APT_MIRROR")])]),t._v(" "),r("td",{staticStyle:{"text-align":"left"}},[t._v("Debian 镜像源")])]),t._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"left"}},[r("code",[t._v("GIT_BRANCH")])]),t._v(" "),r("td",{staticStyle:{"text-align":"left"}},[t._v("指定 Git 分支")])]),t._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"left"}},[r("code",[t._v("GIT_HOST")])]),t._v(" "),r("td",{staticStyle:{"text-align":"left"}},[t._v("指定 GitHub 域名，针对中国大陆加快构建速度")])]),t._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"left"}},[r("code",[t._v("GIT_USER")])]),t._v(" "),r("td",{staticStyle:{"text-align":"left"}},[t._v("指定要拉取之专案所对应的用户名")])]),t._v(" "),r("tr",[r("td",{staticStyle:{"text-align":"left"}},[r("code",[t._v("REPO_NANE")])]),t._v(" "),r("td",{staticStyle:{"text-align":"left"}},[t._v("指定专案名称")])])])]),t._v(" "),r("p",[t._v("修改完成后，开始构建主程序，大约 15 分钟即可完成构建。")]),t._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[t._v("[fdsdr@flydog-sdr-project flydog-sdr]$ docker build --no-cache -t flydog-sdr:latest .\n")])])])])}),[],!1,null,null,null);e.default=a.exports}}]);